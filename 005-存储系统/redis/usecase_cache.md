# 缓存

## 缓存雪崩、缓存击穿和缓存穿透

### 缓存雪崩

1、定义：大量的应用请求无法在缓存中进行处理，致使大量请求发送到数据库层，导致数据库层的压力激增。

2、原因：

- 缓存中有大量数据同时过期。
- 缓存系统不可用。

3、解决方案：

针对原因1:

- **微调过期时间**，避免给大量的数据设置相同的过期时间。可以在一个 base 过期时间基础上增加一个较小的随机数。
- **服务降级**，对不同数据采取不同处理方式。一旦雪崩发生，缓存系统暂停对非核心数据请求的服务，可以直接返回预定义信息、空值或是错误信息。对核心数据的请求仍然允许查询缓存，如果缓存缺失，也可以继续通过数据库读取。

针对原因2:

- 构建缓存**高可用集群**。
- **请求限流**：为了避免连锁反应，我们在业务系统的 API 网关处限制每秒进入系统的请求数，避免过多的请求被发送到数据库。或者，**服务熔断**：彻底暂停宕机的缓存系统和数据库组建对业务请求的服务，直到缓存系统恢复如初。

### 缓存击穿

1、定义：对热点数据的请求，无法在缓存中进行处理，致使大量请求发送到数据库层，导致数据库层的压力激增。

2、原因：热点数据缓存失效。

3、解决方案：对热点数据不设置缓存失效时间。

### 缓存穿透

1、定义：访问的数据既不在缓存中，也不在数据库中，致使缓存系统和数据库层均压力激增。

2、原因：

- 业务层误操作：缓存中的数据和数据库中的数据被误删除了，所以缓存和数据库中都没有数据；
- 恶意攻击：专门访问数据库中没有的数据。

3、解决方案：

- 缓存空值或缺省值。
- 使用**布隆过滤器**快速判断数据是否存在，避免从数据库中查询数据是否存在，减轻数据库压力。
- 提前在入口前端实现恶意请求检测。
- 规范数据操作。